# „Éá„Ç∂„Ç§„É≥„ÅÆÂÆüË£Ö„ÇíËß£‰Ωì„Åô„ÇãÊäÄË°ì

## „Çπ„É©„Ç§„Éâ

* https://speakerdeck.com/operando/dezainfalseshi-zhuang-wojie-ti-suruji-shu

## („Éá„Ç∂„Ç§„É≥„ÇíË™û„ÇãÂâç„Å´...) „Ç®„É≥„Ç∏„Éã„Ç¢„Å™„ÇâÂÆüË£Ö„Åß„Åç„Å™„ÅÑ„Å®„Å≠ÔºÅÔºÅ


## „Éá„Ç∂„Ç§„É≥„ÅÆÂÆüË£Ö„ÇíËß£‰Ωì„Åô„Çã„Å®„ÅØÔºü

* Ëâ≤„Çì„Å™„Ç¢„Éó„É™„ÅÆ„Éá„Ç∂„Ç§„É≥„Éª„É¨„Ç§„Ç¢„Ç¶„Éà„Åå„Å©„ÅÆ„Çà„ÅÜ„Å´ÁµÑ„Åæ„Çå„Å¶„ÅÑ„Çã„ÅÆ„Åã„ÇíË™ø„Åπ„Çã


## Ëß£‰Ωì„Åô„Çã„Åü„ÇÅ„Å´

* Êó•È†É„Åã„ÇâËâ≤„Çì„Å™„Ç¢„Éó„É™„Å´Ëß¶„Çå„Çã
* Ëâ≤„Çì„Å™„Ç∏„É£„É≥„É´„ÅÆ„Ç¢„Éó„É™„Å´Ëß¶„Çå„Çã
* Ëß£‰ΩìÈÅìÂÖ∑„Çí„Å¶„Å™„Åö„Åë„Çã

## Ë©±„ÅôÂÜÖÂÆπ„ÅØËá™Ë∫´„Åå‰Ωú„Å£„Å¶„ÅÑ„Å™„ÅÑ„Ç¢„Éó„É™„Å´‚Ä®ÂØæ„Åó„Å¶„ÅÆ„Ç¢„Éó„É≠„Éº„ÉÅ


## „Éá„Ç∂„Ç§„É≥„ÅÆÊßãÈÄ†„ÇíËß£‰Ωì„Åô„Çã

* Show layout bounds
 * „É¨„Ç§„Ç¢„Ç¶„Éà„ÅÆÂ¢ÉÁïå„ÇíË°®Á§∫„Åô„Çã
 * „É¨„Ç§„Ç¢„Ç¶„Éà„ÅÆÊßãÈÄ†„Åå„Å™„Çì„Å®„Å™„Åè„Çè„Åã„Çã


## Show layout bounds

* ![](./images/show_l.png)


## Show layout bounds

* adb„Åã„ÇâÊúâÂäπ„Å´„Åô„Çã

```bash
adb shell setprop debug.layout true
```


## Show layout bounds

* „É¨„Ç§„Ç¢„Ç¶„Éà„ÅÆÊßãÈÄ†„Åå„Å™„Çì„Å®„Å™„Åè„Çè„Åã„Çã„ÅÆ„Åß‰æøÂà©
* „Åß„ÇÇÈö†„Çå„Å¶„ÇãView„ÇÑÁ¥∞„Åã„ÅÑÊßãÈÄ†„Åå„Çè„Åã„Çâ„Å™„ÅÑ
* Android Device Monitor„ÅÆLayout Inspector„ÅÆ‰æøÂà©ÔºÅ
  * https://developer.android.com/studio/profile/monitor.html
  * https://developer.android.com/studio/debug/layout-inspector.html


## „Éá„Ç∂„Ç§„É≥„ÅÆÊßãÈÄ†„ÇíËß£‰Ωì„Åô„Çã

* ÁîªÈù¢„ÅÆÂØÜÂ∫¶„ÇíÂ§âÊõ¥„Åô„Çã
* ÊñáÂ≠ó„ÅÆ„Çµ„Ç§„Ç∫„ÇíÂ§âÊõ¥„Åô„Çã
* „ÅÇ„Åà„Å¶„É¨„Ç§„Ç¢„Ç¶„Éà„ÅåÂ¥©„Çå„Åù„ÅÜ„Å™„Åì„Å®„Çí„ÇÑ„Å£„Å¶„Åø„Çã
* ÊÉ≥ÂÆöÂ§ñ„ÅÆÁîªÈù¢„ÇÑÊñáÂ≠ó„Çµ„Ç§„Ç∫„Å´„Å©„ÅÜÂØæÂøú„Åó„Å¶„ÅÑ„Çã„ÅãË¶ã„Çã


## ÁîªÈù¢„ÅÆÂØÜÂ∫¶„ÉªÊñáÂ≠ó„ÅÆ„Çµ„Ç§„Ç∫„ÇíÂ§âÊõ¥„Åô„Çã

* Accessibility ‚Üí Font size ‚Üí Largest
* Accessibility ‚Üí Display size ‚Üí Largest

or

* Display ‚Üí Font size ‚Üí Largest
* Display ‚Üí Display size ‚Üí Largest


## ÁîªÈù¢„ÅÆÂØÜÂ∫¶„ÉªÊñáÂ≠ó„ÅÆ„Çµ„Ç§„Ç∫„ÇíÂ§âÊõ¥„Åô„Çã

![](./images/dd.png)
![](./images/font.png)


## ÁîªÈù¢„ÅÆÂØÜÂ∫¶„ÇíÂ§âÊõ¥„Åô„Çã

* adb shell„Åã„Çâ„ÇÇÂ§âÊõ¥„Åß„Åç„Çã„ÇàÔºÅ
* Ë®≠ÂÆöÂÄ§„ÅÆ‰∏äÈôê„Åå„Å™„ÅÑ„ÅÆ„Åß„ÄÅ„ÇÑ„Å∞„ÅÑ‰∏ñÁïå„ÅåË¶ã„Çå„Çã
* ‰∏ãÈôêÂÄ§„ÅØ„ÅÇ„ÇãÔºÅ ‚Üí 72


## ÁîªÈù¢„ÅÆÂØÜÂ∫¶„ÇíÂ§âÊõ¥„Åô„Çã

```bash
// ÂØÜÂ∫¶„ÇíÂ§âÊõ¥„Åô„Çã
adb shell wm density 800

// ÂÖÉ„Å´Êàª„Åô
adb shell wm density reset
```


## ÊñáÂ≠ó„ÅÆ„Çµ„Ç§„Ç∫„ÇíÂ§âÊõ¥„Åô„Çã

* adb shell„Åã„Çâ„ÇÇÂ§âÊõ¥„Åß„Åç„Çã„ÇàÔºÅ
* Ë®≠ÂÆöÂÄ§„ÅÆ‰∏äÈôê„Åå„Å™„ÅÑ„ÅÆ„Åß„ÄÅ„ÇÑ„Å∞„ÅÑ‰∏ñÁïå„ÅåË¶ã„Çå„Çã

```bash
adb shell settings put system font_scale 1.3
```


## ÁîªÈù¢„ÅÆÂØÜÂ∫¶„ÉªÊñáÂ≠ó„ÅÆ„Çµ„Ç§„Ç∫„ÇíÂ§âÊõ¥„Åô„Çã

* ÈôêÁïå„ÅØ„Å™„ÅÑüí™


## ÁîªÈù¢„ÅÆÂØÜÂ∫¶„ÉªÊñáÂ≠ó„ÅÆ„Çµ„Ç§„Ç∫„ÇíÂ§âÊõ¥„Åô„Çã

* „Åü„Å†„ÅóÂ£ä„Çå„Åù„ÅÜüíñ


## „Éá„Ç∂„Ç§„É≥„ÅÆÊßãÈÄ†„ÇíËß£‰Ωì„Åô„Çã

* View Hierarchy„Çídump„Åô„Çã
* `adb shell dumpsys activity top`
* dump„Åó„Åü„ÅÑÁîªÈù¢„ÇíÈñã„ÅÑ„Å¶ÂÆüË°å


## dumpsys activity top

![](./images/view.png)


## dumpsys activity top

* View.GONE„Å®„Åã„ÅßË¶ã„Çå„Å™„ÅÑView„ÇÇ„Çè„Åã„Çã
* ÂãïÁöÑ„Å´View„ÅåÂ§â„Çè„Å£„Åü„Çä„Åó„Å™„Åë„Çå„Å∞‰∏∏Ë¶ã„Åà
* View„ÅÆid„Åå„Çè„Åã„Çã„ÅÆ„Åß„Ç¥„Éã„Éß„Ç¥„Éã„Éß„Åß„Åç„Çã
* „Åß„ÇÇÁ¥∞„Åã„ÅÑÂ±ûÊÄß„ÅÆË®≠ÂÆö„Åå„Çè„Åã„Çâ„Å™„ÅÑ


## „Éá„Ç∂„Ç§„É≥„ÅÆÊßãÈÄ†„ÇíËß£‰Ωì„Åô„Çã

* apk„ÇíËß£‰Ωì„Åô„Çã
* ÊúÄÁµÇÊâãÊÆµ? üí™
* ÊúÄÁµÇÂÖµÂô®? üî™


## apk„ÇíËß£‰Ωì„Åô„Çã„ÉÑ„Éº„É´

* apktool ‚ö°
  * https://ibotpeaches.github.io/Apktool/
* dex2ja üëπ
  * https://github.com/pxb1988/dex2jar
* aapt üî•
  * Android Asset Packaging Tool
  * https://elinux.org/Android_aapt


## Á´ØÊú´„Åã„Çâapk„Çí„Åï„Åè„Å£„Å®Âºï„Å£„ÅìÊäú„Åè

* Á¥†Êô¥„Çâ„Åó„ÅÑË®ò‰∫ã„ÅÇ„Çä„Åæ„ÅôÔºÅ
* dumpsys activity activities„Å®peco„Åß„Ç¥„Éã„Éß„Ç¥„Éã„Éß„Åó„Å¶Á´ØÊú´„Åã„Çâapk„ÇíÁ∞°Âçò„Å´Âºï„Å£„ÅìÊäú„Åè
* https://qiita.com/operandoOS/items/6fa77037560e52d11352


## apk„ÇíËß£‰Ωì„Åô„Çã„ÉÑ„Éº„É´

* Ëß£‰ΩìÊñπÊ≥ï„ÅØ‚Ä¶ „Å≠Ôºü


## Ëß£‰Ωì„Åô„Çã„Å®Êâã„Å´ÂÖ•„Çã„ÇÇ„ÅÆ

* „É™„ÇΩ„Éº„Çπ‰∏ÄÂºè
 * „É¨„Ç§„Ç¢„Ç¶„Éà„Éï„Ç°„Ç§„É´„ÇÇÂê´„ÇÄ
* jar
 * Èõ£Ë™≠Âåñ„Åï„Çå„Å¶„Å™„ÅÑ„Å®‰∏∏Ë¶ã„Åà
 * Èõ£Ë™≠ÂåñÊÄñ„Åè„Å™„ÅÑ„Å†„ÅÑ„Åò„Çá„ÅÜ„Å∂


## ÁõÆÁöÑ„ÅÆ„É¨„Ç§„Ç¢„Ç¶„Éà„Éï„Ç°„Ç§„É´„ÇíË™ø„Åπ„Çã „Åù„ÅÆ1

* Ââç„Å´Á¥π‰ªã„Åó„Åüdumpsys activity top„Åß„É™„ÇΩ„Éº„ÇπID„ÅÆÂêçÂâç„ÅØ„Çè„Åã„Çã
* „ÅÇ„Å®„ÅØID„Åå‰ΩøÁî®„Åï„Çå„Å¶„ÅÑ„Çã„É¨„Ç§„Ç¢„Ç¶„Éà„ÇíË™ø„Åπ„Çã„Å†„Åë
* grep„Åß„ÇÇ„ÅÑ„ÅÑ„Åó„ÄÅ„Ç®„Éá„Ç£„Çø„Éº„ÅÆÊ§úÁ¥¢„Åß„ÇÇ„ÅÑ„ÅÑ


## ÁõÆÁöÑ„ÅÆ„É¨„Ç§„Ç¢„Ç¶„Éà„Éï„Ç°„Ç§„É´„ÇíË™ø„Åπ„Çã „Åù„ÅÆ2

* „É™„ÇΩ„Éº„ÇπID„Åã„ÇâË™ø„Åπ„Çã
  * jar„Çí„Ç¥„Éã„Éß„Ç¥„Éã„Éß„Åó„Å¶Ë¶ã„Çã„Å®„É™„ÇΩ„Éº„ÇπID„Åå„Çè„Åã„Çã
* „Ç≥„Éº„Éâ‰∏ä„ÅÆ„É™„ÇΩ„Éº„ÇπID„Çí16ÈÄ≤Êï∞„Å´Â§âÊèõ„Åô„Çã
  * ÂÖÉ„ÅØ10ÈÄ≤Êï∞„ÄÇÊñπÊ≥ï„ÅØ‰Ωï„Åß„ÇÇ„ÅÑ„ÅÑ„ÅÆ„ÅßÂ§âÊèõ„Åô„Çã
* 16ÈÄ≤Êï∞Âåñ„Åó„ÅüID„ÅßÊ§úÁ¥¢„Åô„Çã
* res/values/public.xml„ÇíÊ§úÁ¥¢„Åô„Çã„Å®Ë¶ã„Å§„Åã„Çã


## ÁõÆÁöÑ„ÅÆ„É¨„Ç§„Ç¢„Ç¶„Éà„Éï„Ç°„Ç§„É´„ÇíË™ø„Åπ„Çã „Åù„ÅÆ3

* „Åù„ÅÆ2„Å®ÈÄî‰∏≠„Åæ„ÅßÂêå„Åò
* aapt„Çí‰Ωø„Å£„Å¶Ë™ø„Åπ„Çã

```bash
aapt d resources base.apk | grep 7f0a0020
```

## ÁõÆÁöÑ„ÅÆ„É¨„Ç§„Ç¢„Ç¶„Éà„Éï„Ç°„Ç§„É´„ÇíË™ø„Åπ„Çã „Åù„ÅÆ3

* ÁîªÂÉè„ÇíË≤º„Çã


## apk„ÇíËß£‰Ωì„Åô„Çã

* „É¨„Ç§„Ç¢„Ç¶„Éà„Éï„Ç°„Ç§„É´„ÅåË¶ã„Çå„Çã„ÅÆ„Åß„Å±„Å™„ÅÑ
* Èõ£Ë™≠Âåñ„Åï„Çå„Å¶„Å™„Åë„Çå„Å∞Custom View„ÇÇ„Çè„Åã„Çã


## „Éá„Ç∂„Ç§„É≥„ÅÆÊßãÈÄ†„ÇíËß£‰Ωì„Åô„Çã

* Ë¶ã„Åü„Åì„Å®„Å™„ÅÑ„Éá„Ç∂„Ç§„É≥„ÅÆÂÆüË£Ö„Çí‰æùÈ†º„Åï„Çå„Åü„Çâ**„Äå„Åì„ÅÆ„Éá„Ç∂„Ç§„É≥„ÄÅ„Å©„ÅÆ„Ç¢„Éó„É™„Å®„Åã„Åß„ÅÇ„Çä„Åæ„Åó„ÅüÔºü„Äç**„ÇíËÅû„Åè
* mazikore daizi
* „Åù„Åì„Åã„Çâ‰ªä„Åæ„ÅßÁ¥π‰ªã„Åó„ÅüËß£‰ΩìË°ì„Çí‰Ωø„ÅÜ


## „Åæ„Å®„ÇÅ

* Ëß£‰Ωì„Åó„Å¶„Éá„Ç∂„Ç§„É≥„ÅÆÂÆüË£Ö„ÅÆÂèÇËÄÉ„Å´„Åô„Çã
* Ê∞ó„Å´„Å™„Å£„Åü„Éá„Ç∂„Ç§„É≥„ÇíËß£‰Ωì„Åó„Å¶„Åø„Å¶„Å≠ÔºÅ
* Ëß£‰Ωì„Åì„Çè„Åè„Å™„ÅÑÔºÅ


## Thanks!!

----

## „Åä„Åæ„Åë


## adb shell dumpsys activity top„ÅßÂá∫„ÇãView Hierarchy„ÅÆÂÜÖÂÆπ„ÇíÁêÜËß£„Åô„Çã

* „Ç≥„Éº„ÉâË™≠„ÇÅÊ°à‰ª∂
* http://tools.oesf.biz/android-8.1.0_r1.0/xref/frameworks/base/core/java/android/view/View.java#5482

## adb shell settings put system font_scaleÂë®„Çä

* ÂÆöÁæ©„ÅØ‰ª•‰∏ã
 * http://tools.oesf.biz/android-8.1.0_r1.0/xref/frameworks/base/core/java/android/provider/Settings.java#2996

```java
/**
 * Scaling factor for fonts, float.
 */
public static final String FONT_SCALE = "font_scale";
```

* 0‰ª•‰∏ä„Å™„Çâ„ÅÑ„Åè„Çâ„Åß„ÇÇÂÄ§„ÇíË®≠ÂÆö„Åß„Åç„Çã„ÅÆ„Åß‰∏äÈôê„Åå„Å™„ÅÑ
  * „ÅÑ„Åè„Çâ„Åß„ÇÇÊñáÂ≠ó„Çµ„Ç§„Ç∫Â§ß„Åç„Åè„Åß„Åç„Çã
  * „É§„Éê„Åù„ÅÜÔΩó
  * http://tools.oesf.biz/android-8.1.0_r1.0/xref/frameworks/base/core/java/android/provider/Settings.java#3001

```java
private static final Validator FONT_SCALE_VALIDATOR = new Validator() {
    @Override
    public boolean validate(String value) {
        try {
            return Float.parseFloat(value) >= 0;
        } catch (NumberFormatException e) {
            return false;
        }
    }
};
```


## adb shell wm densityÂë®„Çä

* http://tools.oesf.biz/android-8.1.0_r1.0/xref/frameworks/base/cmds/wm/src/com/android/commands/wm/Wm.java
  * adb shell wmÂÆüË°å„Åó„ÅüÊôÇ„Å´Âãï„Åè„ÇÑ„Éº„Å§
* adb shell wm density XXX„ÅßÂãï„Åè„Å®„Åì„Çç
  * http://tools.oesf.biz/android-8.1.0_r1.0/xref/frameworks/base/cmds/wm/src/com/android/commands/wm/Wm.java#198
  * 72‰ª•‰∏ä„Å™„ÇâË®≠ÂÆö„Åß„Åç„Åù„ÅÜ

```java
private void runDisplayDensity() throws Exception {
    String densityStr = nextArg();
    int density;
    if (densityStr == null) {
        try {
            int initialDensity = mWm.getInitialDisplayDensity(Display.DEFAULT_DISPLAY);
            int baseDensity = mWm.getBaseDisplayDensity(Display.DEFAULT_DISPLAY);
            System.out.println("Physical density: " + initialDensity);
            if (initialDensity != baseDensity) {
                System.out.println("Override density: " + baseDensity);
            }
        } catch (RemoteException e) {
        }
        return;
    } else if ("reset".equals(densityStr)) {
        density = -1;
    } else {
        try {
            density = Integer.parseInt(densityStr);
        } catch (NumberFormatException e) {
            System.err.println("Error: bad number " + e);
            return;
        }
        if (density < 72) {
            System.err.println("Error: density must be >= 72");
            return;
        }
    }
    try {
        if (density > 0) {
            // TODO(multidisplay): For now Configuration only applies to main screen.
            mWm.setForcedDisplayDensityForUser(Display.DEFAULT_DISPLAY, density,
                    UserHandle.USER_CURRENT);
        } else {
            mWm.clearForcedDisplayDensityForUser(Display.DEFAULT_DISPLAY,
                    UserHandle.USER_CURRENT);
        }
    } catch (RemoteException e) {
    }
}
```