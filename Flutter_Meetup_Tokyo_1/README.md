# Flutter Package & Plugin Package

## About Me

## æŠ€è¡“æ›¸å…¸4ã§æœ¬å‡ºã—ã¾ã™ï¼

* ã“ã†ã—ã¦åƒ•ã‚‰ã¯ã€æ›¸ç±ã‚’å£²ã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œã£ãŸ 2.0.1
* ãœã²è²·ã„ã«æ¥ã¦ã­ï¼
* Flutterå…¨ãé–¢ä¿‚ãªã„ã§ã™ï¼
* https://techbookfest.org/event/tbf04/circle/14710011


## ã“ã‚Œã‹ã‚‰ç´¹ä»‹ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®URLã ã‘è¦šãˆã¦å¸°ã£ã¦ãã ã•ã„ï¼ï¼ãã‚ŒãŒã™ã¹ã¦ã§ã™ï¼ï¼


## Package & Plugin document

*  Using Packages
 * https://flutter.io/using-packages/
* Developing Packages & Plugins
 * https://flutter.io/developing-packages/
* Platform-specific code
 * https://flutter.io/platform-channels/

## What is a Packages?

* Dartã¯pubã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ã•ã‚Œã¦ã‚‹
* Flutterã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æ¢ã™ã¨ã“ã‚ã‚‚ã‚ã‚‹
* https://pub.dartlang.org/flutter
* ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨æ€ã£ã¦ã‚‚ã‚‰ã†ã¨ã‚ã‹ã‚Šã‚„ã™ã„


## Flutter Package types

* Flutterã§ã¯ã–ã£ãã‚ŠPackage typesãŒåˆ†ã‹ã‚Œã¦ã‚‹
* Dart packages
* Plugin packages


## Dart packages

* Dartã§æ›¸ã‹ã‚ŒãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒª
* Flutterå›ºæœ‰ã®æ©Ÿèƒ½ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚‚ã‚ã‚‹

## Dart packages

* fluro
* The brightest, hippest, coolest router for Flutter.
* Flutterã®æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ã‚‹ã‘ã©ã€Nativeã®æ©Ÿèƒ½ã¯ä½¿ã£ã¦ãªã„
* https://pub.dartlang.org/packages/fluro

## Plugin packages

* Dartã§æ›¸ã‹ã‚ŒãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒª
* ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ (iOS/Android)å›ºæœ‰ã®å®Ÿè£…ã¨çµ„ã¿åˆã‚ã›
* Native Bridgeãƒ©ã‚¤ãƒ–ãƒ©ãƒªçš„ãª

## Plugin packages

* shared_preferences
* Wraps NSUserDefaults (on iOS) and SharedPreferences (on Android), providing a persistent store for simple data.
* Flutterã‹ã‚‰Nativeã®æ©Ÿèƒ½ãƒ»APIã‚’å‘¼ã³å‡ºã™
* https://pub.dartlang.org/packages/shared_preferences


## Flutter plugins

* Flutter teamã§ç®¡ç†ã•ã‚Œã¦ã‚‹Pluginé”
* https://github.com/flutter/plugins
* ã“ã“ã«ã‚ã‚‹ã®ã¯Plugin packagesã®ã¿
* Native Bridgeå®Ÿè£…ã®å‚è€ƒã«ãªã‚‹ã‚³ãƒ¼ãƒ‰æº€è¼‰ã£ã½ã„
* Firebaseã®PluginãŒå……å®Ÿã—ã¦ã‚‹


## Native Bridgeã®ä»•çµ„ã¿

* ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆèª­ã‚“ã§ãã ã•ã„ï¼
* Writing custom platform-specific code with platform channels
* https://flutter.io/platform-channels/

## Native Bridgeã®ä»•çµ„ã¿

![](https://flutter.io/images/PlatformChannels.png)

## Developing Plugin Packages

* è¤‡é›‘ãªã‚‚ã®ã˜ã‚ƒãªã‘ã‚Œãªã•ãã£ã¨ä½œã‚Œã‚‹
* å„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®APIçŸ¥ã£ã¦ã‚‹ã¨æ¥½å‹
* pubã¸ã®å…¬é–‹ã‚‚ç°¡å˜


## Developing Plugin Packages

* ä»Šæ—¥ã®æ·±å¤œã«ä½œã£ãŸ
* Flutterã‹ã‚‰å„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®åºƒå‘ŠIDã‚’å–å¾—ã™ã‚‹ã‚„ãƒ¼ã¤ãƒ¼
* https://pub.dartlang.org/packages/advertising_id
* https://github.com/operando/advertising_id

## Create the plugin packages

* IntelliJ or Android Studioã‹ã‚‰ä½œã‚‹ã®ãŒæ¥½

![](./flutter_plugin.png)

## Create the plugin packages

* ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰ã§ã‚‚ä½œã‚Œã‚‹
* Nativeã®ã‚³ãƒ¼ãƒ‰ã‚’Swiftã¨Kotlinã§æ›¸ããªã‚‰ä»¥ä¸‹
* `flutter create --template=plugin -i swift -a kotlin advertising_id`

## [advertising_id.dart](https://github.com/operando/advertising_id/blob/master/lib/advertising_id.dart)

```dart
import 'dart:async';

import 'package:flutter/services.dart';

class AdvertisingId {
  static const MethodChannel _channel =
      const MethodChannel('advertising_id');

  static Future<String> get id async {
    final String id = await _channel.invokeMethod('getAdvertisingId');
    return id;
  }
}
```

## [AdvertisingIdPlugin.kt](https://github.com/operando/advertising_id/blob/master/android/src/main/kotlin/com/os/operando/advertisingid/AdvertisingIdPlugin.kt)

```kotlin
class AdvertisingIdPlugin(private val registrar: Registrar) : MethodCallHandler {

    companion object {
        @JvmStatic
        fun registerWith(registrar: Registrar) {
            val channel = MethodChannel(registrar.messenger(), "advertising_id")
            channel.setMethodCallHandler(AdvertisingIdPlugin(registrar))
        }
    }

    override fun onMethodCall(call: MethodCall, result: Result) {
        when (call.method) {
            "getAdvertisingId" -> thread {
                try {
                    result.success(AdvertisingIdClient.getAdvertisingIdInfo(registrar.context()).id)
                } catch (e: Exception) {
                    result.success("")
                }
            }
            else -> result.notImplemented()
        }
    }
}
```

## [SwiftAdvertisingIdPlugin.swift](https://github.com/operando/advertising_id/blob/master/ios/Classes/SwiftAdvertisingIdPlugin.swift)

```swift
import Flutter
import UIKit
import AdSupport

public class SwiftAdvertisingIdPlugin: NSObject, FlutterPlugin {
  public static func register(with registrar: FlutterPluginRegistrar) {
    let channel = FlutterMethodChannel(name: "advertising_id", binaryMessenger: registrar.messenger())
    let instance = SwiftAdvertisingIdPlugin()
    registrar.addMethodCallDelegate(instance, channel: channel)
  }

  public func handle(_ call: FlutterMethodCall, result: @escaping FlutterResult) {
    switch call.method {
    case "getAdvertisingId":
        var idfaString: String!
        let manager = ASIdentifierManager.shared()
        if manager.isAdvertisingTrackingEnabled {
            idfaString = manager.advertisingIdentifier.uuidString
        } else {
            idfaString = ""
        }
        result(idfaString)
    default:
        result(nil)
    }
  }
}
```

## [pubspec.yaml](https://github.com/operando/advertising_id/blob/master/pubspec.yaml)

```yaml
name: advertising_id
description: A Flutter plugin to access advertising ID.
version: 0.9.0
author: Shinobu Okano <okanoshinobu8@gmail.com>
homepage: https://github.com/operando/advertising_id

flutter:
  plugin:
    androidPackage: com.os.operando.advertisingid
    pluginClass: AdvertisingIdPlugin

dependencies:
  flutter:
    sdk: flutter

environment:
  sdk: ">=1.21.0 <3.0.0"
  flutter: ">=0.1.4"
```

## Publishing packages

* Publishã®ã‚³ãƒãƒ³ãƒ‰ãŒç”¨æ„ã•ã‚Œã¦ã‚‹
* --dry-runã‚’ã¤ã‘ã¦å•é¡Œãªã„ã‹ç¢ºèª
* `flutter packages pub publish --dry-run`

## Publishing packages

* ãƒ€ãƒ¡ãªã¨ã“ã‚ã¨ã‹è¦ªåˆ‡ã«æ•™ãˆã¦ãã‚Œã‚‹ã®ã§æœ€é«˜â˜º

![](./pub.png)

## Publishing packages

* pubspec.yamlã®æ›¸ãæ–¹ã¯Pubspec Formatã®documentã‚’è¦‹ã‚‹ã¨è¦ªåˆ‡ã«æ›¸ã„ã¦ã‚ã‚‹
* https://www.dartlang.org/tools/pub/pubspec

## Publishing packages

* pubã«publishã™ã‚‹
* ã¯ã˜ã‚ã¦pubã«publishã™ã‚‹æ™‚ã ã‘Googleã®èªè¨¼ãŒèµ°ã‚‹
* `flutter packages pub publish`


## ç–‘å•

* pubã«ã‚ã’ãŸpackageã£ã¦æ¶ˆã›ãªã„ã®ã‹ãªï¼ŸğŸ¤”


## ã¾ã¨ã‚

* ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ã¯pubãŒã¡ã‚ƒã‚“ã¨ã—ã¦ã‚‹ã®ã§ç°¡å˜ï¼
* Plugin Packageã¯ç°¡å˜ã«ä½œã‚Œã‚‹ãƒ»å…¬é–‹ã§ãã‚‹
* å„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®APIçŸ¥ã£ã¦ã‚‹ã¨æ¥½å‹
* **ã˜ã‚ƒã‚“ã˜ã‚ƒã‚“Plugin Packageä½œã‚‹ãƒãƒ£ãƒ³ã‚¹ï¼**

## Thanks!!